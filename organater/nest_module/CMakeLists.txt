# organater/nest_module/CMakeLists.txt (æœ€çµ‚ãƒ“ãƒ«ãƒ‰æˆåŠŸã‚’ç›®æŒ‡ã™ç‰ˆ V8)

cmake_minimum_required(VERSION 3.5)
project(nest_module CXX)

# =========================================================================
# ğŸš¨ æœ€çµ‚å›é¿ç­–ã®å®šç¾© (ãƒ‘ã‚¹ã¯å›ºå®š)
# =========================================================================

# NESTã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‘ã‚¹ã‚’å®šç¾©
set(NEST_INSTALL_PREFIX "/home/s24156/data/.venv")
set(NEST_SOURCE_DIR "/home/s24156/data/nest-simulator")
set(MODULE_ROOT_DIR "/home/s24156/data/organater/nest_module")

# -------------------------------------------------------------
# NESTã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’ç›´æ¥æŒ‡å®š
# -------------------------------------------------------------

# ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è¨­å®š
include_directories(
  SYSTEM
  ${NEST_INSTALL_PREFIX}/include/nest  # 1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸNESTã®ãƒ˜ãƒƒãƒ€ãƒ¼
  
  # ğŸ’¡ NESTã®ã‚½ãƒ¼ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®æœ€çµ‚èª¿æ•´ãƒ‘ã‚¹ (V8: å…¨ã¦ã‚’å«ã‚ã‚‹)
  ${NEST_SOURCE_DIR}                   # 2. ã‚½ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒˆ (lib/ ã‚„ models/ ã®è¦ª)
  ${NEST_SOURCE_DIR}/lib               # 3. <lib/...> ã‚’è§£æ±ºã™ã‚‹ãŸã‚
  ${NEST_SOURCE_DIR}/models            # 4. â¬…ï¸ <models/...> ã‚’è§£æ±ºã™ã‚‹ãŸã‚
  ${NEST_SOURCE_DIR}/nestkernel        # 5. nestkernelå†…ã®ã‚³ã‚¢ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç¶²ç¾…
  
  # ğŸ’¡ ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®ãƒ‘ã‚¹
  ${MODULE_ROOT_DIR}                   # module.h ãŒã‚ã‚‹ãƒ‘ã‚¹
  ${MODULE_ROOT_DIR}/models            # local_learning_synapse.h ãŒã‚ã‚‹ãƒ‘ã‚¹
)

# ğŸ’¡ å…±æœ‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®šç¾©
add_library(nest_module MODULE
    module.cpp
    models/local_learning_synapse.cpp
)

# å¿…è¦ãªNESTãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ãƒªãƒ³ã‚¯ (ä»®æƒ³ç’°å¢ƒå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«)
target_link_libraries(nest_module PUBLIC
    ${NEST_INSTALL_PREFIX}/lib/nest/libnestkernel.so
    ${NEST_INSTALL_PREFIX}/lib/nest/libmodels.so
    ${NEST_INSTALL_PREFIX}/lib/nest/libnest.so
)

# C++è¦æ ¼ã‚’æŒ‡å®š
target_compile_features(nest_module PUBLIC cxx_std_17)

# å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®rpathã‚’è¨­å®š
set_target_properties(nest_module PROPERTIES
    BUILD_WITH_INSTALL_RPATH TRUE
    INSTALL_RPATH "${NEST_INSTALL_PREFIX}/lib/nest"
    INSTALL_RPATH_USE_ORIGIN TRUE
    SKIP_INSTALL_RPATH FALSE
)