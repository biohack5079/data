# organater/python_scripts/network.py

import nest

def create_network():
    """
    ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã—ã€ã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒŠãƒ—ã‚¹ãƒ¢ãƒ‡ãƒ«ã§æ¥ç¶šã—ã¾ã™ã€‚
    ã“ã“ã§ã¯ã€å˜ç´”ãª3å±¤æ§‹é€ ï¼ˆå…¥åŠ›ã€ä¸­é–“ã€å‡ºåŠ›ï¼‰ã‚’æƒ³å®šã—ã¾ã™ã€‚
    """
    
    # ----------------------------------------------------
    # 1. ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³ã®ä½œæˆ
    # ----------------------------------------------------
    
    # ç”Ÿç‰©å­¦çš„å¦¥å½“æ€§ã‚’è€ƒæ…®ã—ã€HHãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ï¼ˆãŸã ã—è¨ˆç®—è² è·ã«æ³¨æ„ï¼‰
    input_size = 3    # ä¾‹: XORã‚²ãƒ¼ãƒˆã®å…¥åŠ›ã‚„å˜ç´”ãªåˆºæ¿€
    hidden_size = 5   # ä¸­é–“å±¤ï¼ˆå­¦ç¿’ã‚’è¡Œã†å˜ä½“ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³ã®ä»£ã‚ã‚Šï¼‰
    output_size = 2   # å‡ºåŠ›å±¤ï¼ˆä¾‹: å¿œç­”ã€ã‚¨ãƒ©ãƒ¼ä¿¡å·ã‚’å—ã‘å–ã‚‹å ´æ‰€ï¼‰

    # ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³ãƒ¢ãƒ‡ãƒ«ã®é¸æŠ: LFPãƒ¢ãƒ‡ãƒ«ã® hh_psc_alpha ã‚’ä½¿ç”¨
    input_neurons = nest.Create("hh_psc_alpha", input_size)
    hidden_neurons = nest.Create("hh_psc_alpha", hidden_size)
    output_neurons = nest.Create("hh_psc_alpha", output_size)

    # ----------------------------------------------------
    # 2. ã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒŠãƒ—ã‚¹ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    # ----------------------------------------------------
    
    # ğŸ’¡ C++ã§å®šç¾©ã—ãŸã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒŠãƒ—ã‚¹ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š
    syn_spec_local_learning = {
        "model": "local_learning_synapse",  # ğŸ’¡ nest_module/module.cpp ã§ç™»éŒ²ã—ãŸåå‰
        "weight": 5.0,                      # åˆæœŸã‚·ãƒŠãƒ—ã‚¹é‡ã¿
        "delay": 1.0,                       # ã‚·ãƒŠãƒ—ã‚¹é…å»¶ (ms)
        "eta": 0.001,                       # C++ã§å®šç¾©ã—ãŸå­¦ç¿’ç‡ (learning_rate)
        "min_w": 0.0,                       # æœ€å°é‡ã¿
        "max_w": 10.0                       # æœ€å¤§é‡ã¿
        # ğŸ’¡ ãã®ä»–ã€ã‚¨ãƒ©ãƒ¼ä¿¡å·ä¼é”ã«å¿…è¦ãªã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
    }

    # ----------------------------------------------------
    # 3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ¥ç¶š
    # ----------------------------------------------------

    # â‘  å…¥åŠ›å±¤ -> ä¸­é–“å±¤ã®æ¥ç¶šï¼ˆã‚«ã‚¹ã‚¿ãƒ å­¦ç¿’ï¼‰
    # ã“ã®æ¥ç¶šã§ã€èª¤å·®é€†ä¼æ’­ã‚’ä½¿ã‚ãªã„å±€æ‰€çš„ãªå­¦ç¿’ãŒè¡Œã‚ã‚Œã¾ã™ã€‚
    nest.Connect(
        input_neurons, 
        hidden_neurons, 
        syn_spec=syn_spec_local_learning
    )
    
    # â‘¡ ä¸­é–“å±¤ -> å‡ºåŠ›å±¤ã®æ¥ç¶šï¼ˆé™çš„ã¾ãŸã¯åˆ¥ã®å­¦ç¿’å‰‡ï¼‰
    # ç°¡å˜ã®ãŸã‚ã€é™çš„ï¼ˆå­¦ç¿’ãªã—ï¼‰ãªã‚·ãƒŠãƒ—ã‚¹ã§æ¥ç¶š
    nest.Connect(
        hidden_neurons, 
        output_neurons, 
        syn_spec={"model": "static_synapse", "weight": 2.0}
    )

    # â‘¢ å‡ºåŠ›å±¤ -> å…¥åŠ›/ä¸­é–“å±¤ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ¥ç¶šï¼ˆå­¦ç¿’ã«å¿…è¦ãªã‚¨ãƒ©ãƒ¼ä¿¡å·ã®ä¼é”ï¼‰
    # ğŸ’¡ ã”æç¤ºã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ã€Œã‚¨ãƒ©ãƒ¼ç‡ã€ã‚’ä¼é”ã™ã‚‹ãŸã‚ã®é‡è¦ãªå›è·¯
    # C++ã®ã‚·ãƒŠãƒ—ã‚¹ãƒ¢ãƒ‡ãƒ«ãŒã“ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¿¡å·ã‚’å—ã‘å–ã£ã¦é‡ã¿ã‚’æ›´æ–°ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã§ã™ã€‚
    nest.Connect(
        output_neurons, 
        hidden_neurons, 
        syn_spec={"model": "static_synapse", "weight": -1.0} # ä¾‹: æŠ‘åˆ¶æ€§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    )

    # å…¨ã¦ã®ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³ã‚’ã¾ã¨ã‚ã¦è¿”ã™ï¼ˆrecorder.pyãªã©ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼‰
    all_neurons = list(input_neurons) + list(hidden_neurons) + list(output_neurons)
    return all_neurons